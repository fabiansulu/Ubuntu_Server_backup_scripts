#!/bin/bash
# /usr/local/bin/backup.sh
# Script de sauvegarde système + liste des paquets installés
# Auteur : Authentik
# Date : $(date +%Y-%m-%d)

set -euo pipefail  # Sécurité du script : stop en cas d'erreur

# === VARIABLES ===
DEST="/chemin/vers/destination"   # Répertoire de destination de la sauvegarde
PKG_LIST="$DEST/package-list.txt" # Fichier contenant la liste des paquets

# === SAUVEGARDE LISTE DES PAQUETS ===
echo "[INFO] Sauvegarde de la liste des paquets installés..."
dpkg --get-selections > "$PKG_LIST"

# === SAUVEGARDE SYSTEME VIA RSYNC ===
echo "[INFO] Sauvegarde complète du système vers $DEST ..."
rsync -aAXv \
  --exclude={"/dev/*","/proc/*","/sys/*","/tmp/*","/run/*","/mnt/*","/media/*","/lost+found"} \
  / "$DEST"

echo "[OK] Sauvegarde terminée avec succès ($(date))"
